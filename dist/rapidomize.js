!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.rapidomize=n():e.rapidomize=n()}(this,(function(){return function(e){var n={};function t(o){if(n[o])return n[o].exports;var i=n[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,t),i.l=!0,i.exports}return t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:o})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var i in e)t.d(o,i,function(n){return e[n]}.bind(null,i));return o},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=0)}([function(e,n,t){let o,i,r,s={},l=!1;let u={ack:e=>{},err:e=>{}};const a="GET",c="POST",f="PUT",p="DELETE";let d;function g(e,n){return i?!e||"string"!=typeof e||e.length>2048?v("invalid request uri/path"):!(n=n||o)||"string"!=typeof n||n.length>60?v("Invalid icappId!"):`/api/v1/agw/${n}/${e}`:v("Rapidomize is not initialized!")}const m=t(1);function y(e,n,t,o=null){let i=d;e!=a&&t&&(t=JSON.stringify(t),i={...d,"Content-Length":Buffer.byteLength(t)}),console.log("uri",e,n,i,t);const r=m.request({protocol:"https:",hostname:"ics.rapidomize.com",port:443,path:n,method:e,headers:i},e=>{let n=e.headers["content-type"];const t=e.statusCode;console.log("Content-Type",n),console.log("status",t,e.statusMessage);let i=[];e.on("data",e=>{i.push(e)}),e.on("end",()=>{i=Buffer.concat(i);let r=n.indexOf(";");switch(r>0&&(n=n.substring(0,r)),n){case"text/plain":i=i.toString();break;case"application/json":i=JSON.parse(i.toString())}if(console.log("body: ",i),o){if(t>=200&&t<300)return void o.ack(i);{let r;r="application/json"==n?Object.keys(i).length>0&&i.err?i.err:e.statusMessage:i,o.err({err:r,status:t})}}})});r.on("error",e=>{console.error(e)}),t&&r.write(t),r.end()}function b(){let e=(n="rapidomize-session","undefined"==typeof window?r.get(n):localStorage.getItem(n));var n;return e?JSON.parse(e):null}function v(e){if(l)throw new Error(e);return console.log(e),!1}e.exports={init:function(e,n,t=null,u=null){!e||e.length>60||!n?console.warn("Failed to initialize rapidomize!!"):(_appId=e,o=t,s=Object.assign(s,u),function(e){d={"Content-Type":"application/json",Accept:"application/json, text/plain;q=0.9",Connection:"keep-alive",Authorization:"Basic "+Buffer.from(":"+e).toString("base64")}}(n),i="/api/v1/mo/"+e,"undefined"==typeof window&&(l=!0,r=new Map))},trigger:function(e,n,t=u){if(!i)return v("Rapidomize is not initialized!");if(!(e=e||o)||e.length>60||!n)return void console.log("missing req params",e,n);let r=n;if(s.session){const e=b();if(!e||!e.sessionId&&!e.userId)return void console.log("invalid session - call setSession() before using");r=Object.assign(n,e)}y(c,`${i}/icapp/${e}`,r,t)},event:function(e,n=null,t=null){if(!i)return;if(!(t=t||o)||t.length>60||!e)return void console.log("missing req params for event",t,e);let r={n:e},s=n?Object.assign(r,n):r;const l=b();if(!l||!l.sessionId&&!l.userId)return void console.log("invalid session - call setSession() before using");const u=Object.assign(s,l);y(c,`${i}/icapp/${t}/event`,u)},setSession:function(e,n=null,t=null){let o={sessionId:e};var i,s;n&&(o.userId=n),t&&(o.userProps=t),i="rapidomize-session",s=JSON.stringify(o),"undefined"==typeof window?r.set(i,s):localStorage.setItem(i,s)},clearSession:function(){var e;e="rapidomize-session","undefined"==typeof window?r.delete(e):localStorage.removeItem(e)},get:function(e,n=null,t=null){let o=g(e,n);o&&y(a,o,null,t)},post:function(e,n,t=null,o=null){let i=g(e,t);i&&y(c,i,n,o)},put:function(e,n,t=null,o=null){let i=g(e,t);i&&y(f,i,n,o)},del:function(e,n,t=null,o=null){let i=g(e,t);i&&y(p,i,n,o)},LifeCycleHandler:u}},function(e,n){e.exports=require("https")}])}));